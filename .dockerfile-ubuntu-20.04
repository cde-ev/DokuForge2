FROM ubuntu:20.04

RUN apt-get update
RUN DEBIAN_FRONTEND=noninteractive TZ=Etc/UTC\
    apt-get install -y apt-utils \
                       rcs \
                       subversion \
                       git \
                       libjs-mathjax \
                       python3 \
                       python3-werkzeug \
                       tzdata \
                       python3-jinja2 \
                       python3-webtest \
                       python3-pip

RUN python3 -m pip install --no-cache-dir wsgitools epydoc

ARG DOKUFORGE_COMMIT_ID
ENV DOKUFORGE_COMMIT_ID=$DOKUFORGE_COMMIT_ID

COPY .git /DokuForge2/.git
WORKDIR /DokuForge2/
RUN git checkout $DOKUFORGE_COMMIT_ID .

RUN pip install --no-cache-dir -r requirements.txt

# for newer markupsafe, we get an error
RUN pip install markupsafe==2.0.1

EXPOSE 8800
