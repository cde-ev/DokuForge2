{% extends "base.html" %}
{% block subheading %}
Übersicht
{% endblock %}
{% block location %}
{{ complexnavbar([("groupindex", dict(group=group), allgroups[group]|e)]) }}
{% endblock %}
{% block content %}
<div class="academylist">
{%- for academy in academies -%}
  {%- if group in academy.groups -%}
    {%- if user.allowedRead(academy) %}
	    <div class="academyitem">
	      <a href="{{ buildurl("academy", dict(academy=academy.name))|e }}">{{ academy.title|e }}</a>
	      <div class="infostring">{{ "Letzte Änderung von %s am %s" | format(academy.lastchange['author'], academy.lastchange['date']) | e }}&nbsp;|&nbsp;{{ academy.estimate.output() | e}}</div>
	    </div>
	    {%- else -%}
	    <div class="academyitem">{{ academy.title|e }}</div>
    {%- endif -%}
  {%- endif -%}
{%- else -%}
<em>Keine Akademien gefunden.</em>
{%- endfor -%}
</div>
{%- if allowedgroups | length > 1 or user.mayCreate() -%}
<div class="contextbox">
  {%- if allowedgroups | length > 1 -%}
  <script type="text/javascript">
  function changegroup (select) {
      {# FIXME this patches together the target url, not as intended with buildurl,
	 but manually since we don't know it at template construction time. #}
      window.location = "{{buildurl("groups")|e}}" + select.options[select.options.selectedIndex].value
  }
  </script>
  <form action="{{ buildurl("groupsselect")|e }}" method="post" id="selectgroup">
  <select name="group" onchange="changegroup(this)">
  {%- for onegroup in allowedgroups -%}
    {%- if onegroup == group -%}
    <option value="{{onegroup|e}}" selected>{{ allgroups[onegroup]|e }}</option>
    {%- else -%}
    <option value="{{onegroup|e}}">{{ allgroups[onegroup]|e }}</option>
    {%- endif -%}
  {%- endfor -%}
  </select>
	  <input type="submit" name="submit" value="Gruppe wechseln">
  </form>
  {%- endif -%}
  {%- if user.mayCreate() -%}
  <a href="{{ buildurl("createacademy")|e }}">Neue Akademie anlegen</a>
  {% endif %}
</div>
{%- endif -%}
{% endblock %}
