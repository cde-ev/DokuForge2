{% extends "base.html" %}

{% block title %}
    {{ course.title }}
{% endblock %}

{% block breadcrumb %}
    {{ util.breadcrumb_link(buildurl("index"), "Übersicht") }}
    {{ util.breadcrumb_link(buildurl("academy"), academy.title) }}
    {{ util.breadcrumb_link(buildurl("course"), course.title, active=True) }}
{% endblock %}

{% block navigation %}
    {%- if user.allowedMeta(academy) or user.allowedWrite(academy, course) %}
        <h6>Kurs</h6>
        <div class="list-group side-nav">
            {% if user.allowedMeta(academy) %}
                {{ util.nav_link(buildurl("coursetitle"), "Titel bearbeiten", aclass="btn-warning") }}
            {% endif %}
            {% if user.allowedWrite(academy, course) %}
                {{ util.nav_link(buildurl("showdeadpages"), "gelöschte Teile", aclass="btn-info") }}
            {% endif %}
            {% if user.allowedMeta(academy) %}
                {{ util.nav_button(buildurl("deletecourse"), "Kurs löschen", aclass="btn-danger") }}
            {% endif %}
            {% if user.allowedWrite(academy, course) %}
                {{ util.nav_button(buildurl("createpage"), "Neuen Teil anlegen", aclass="btn-success") }}
            {% endif %}
        </div>
    {% endif %}
    {%- if user.mayExport(academy) %}
        <h6>Export</h6>
        <div class="list-group side-nav">
            {{ util.nav_link(buildurl("raw"), "df2-Rohdaten", aclass="btn-info") }}
        </div>
    {%- endif -%}
{% endblock %}

{% block content %}
Seitensch&auml;tzer: {{estimate.pages | round(2) | e}} Seiten,
{{estimate.blobs | e}} Abbildungen [{{estimate.blobpages | round(2) | e}} zus&auml;tzliche Seiten],
{{estimate.ednotepages | round(2) | e}} Seiten Ednotes
{%- if course.pages %}
<div class="toc">
	{%- for page in course.outlines %}
	<div class="tocpart">
	   <table>
	     <tr>
	       <td >
		 <div class="tocnumber">
		   <a href="{{ buildurl('page', {'page': page.number})|e }}" class="inconspicuous">{{loop.index|e}}</a></div>
                 <a href="{{ buildurl('page', {'page': page.number})|e }}"> Teil&nbsp;#{{ page.number|string }}</a>
		 </td>
	         <td class="tocoutline">
                {%- for (type, title) in page.items() -%}
		    {# FIXME links currently link only to a page, not to a specific heading. #}
	            {%- if type == "heading" -%}
	                <div class="tocheading"><a href="{{ buildurl('page', {'page': page.number})|e }}" class="inconspicuous">{{title|e}}</a></div>
	            {%- elif type == "subheading" -%}
	                <div class="tocsubheading"><a href="{{ buildurl('page', {'page': page.number})|e }}" class="inconspicuous">{{title|e}}</a></div>
	            {%- endif -%}
		{%- else -%}
	                <div class="tocempty"><a href="{{ buildurl('page', {'page': page.number})|e }}" class="inconspicuous">(...)</a></div>
                {%- endfor -%}
		</td>
		<td>
		{%- if not loop.first -%}
		   {%- if user.allowedWrite(academy, course) %}
               {{ util.button(buildurl("moveup"), "Hochrücken", dict(number=loop.index0), aclass="btn-sm btn-primary", inline=True) }}
		   {%- endif -%}
		{%- endif -%}
		</td>
	      </tr>
	   </table>
           <div class="versionstring">{{ page.versionstring|e }} ({{page.estimate.pages | round(2) | e}} Seiten,
{{page.estimate.blobs | e}} Abbildungen [{{page.estimate.blobpages | round(2) | e}} zus&auml;tzliche Seiten],
{{page.estimate.ednotepages | round(2) | e}} Seiten Ednotes)</div>
	</div>
	
	{%- endfor %}
</div>
{%- else -%}
<br>
<em>Keine Teile gefunden.</em><br>
{%- endif -%}
{% endblock %}
